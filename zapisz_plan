// /api/zapisz_plan.js
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  process.env.SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);

export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Metoda niedozwolona' });
  }

  const { email, plan } = req.body;

  if (!email || !plan) {
    return res.status(400).json({ error: 'Brak emaila lub planu' });
  }

  const { error } = await supabase.from('pending_plans').upsert(
    {
      email,
      plan_name: plan,
      created_at: new Date().toISOString(),
    },
    { onConflict: 'email' } // zakładamy, że kolumna email jest unikalna
  );

  if (error) {
    return res.status(500).json({ error: 'Błąd podczas zapisu planu' });
  }

  return res.status(200).json({ message: 'Plan zapisany pomyślnie' });
}
